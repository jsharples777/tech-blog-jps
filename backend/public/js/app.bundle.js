!function(e){function t(t){for(var i,s,o=t[0],c=t[1],d=t[2],u=0,m=[];u<o.length;u++)s=o[u],Object.prototype.hasOwnProperty.call(a,s)&&a[s]&&m.push(a[s][0]),a[s]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(e[i]=c[i]);for(l&&l(t);m.length;)m.shift()();return r.push.apply(r,d||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],i=!0,o=1;o<n.length;o++){var c=n[o];0!==a[c]&&(i=!1)}i&&(r.splice(t--,1),e=s(s.s=n[0]))}return e}var i={},a={0:0},r=[];function s(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=i,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(n,i,function(t){return e[t]}.bind(null,i));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var o=window.webpackJsonp=window.webpackJsonp||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var d=0;d<o.length;d++)t(o[d]);var l=c;r.push([140,1]),n()}({140:function(e,t,n){e.exports=n(150)},149:function(e,t,n){var i={"./af":4,"./af.js":4,"./ar":5,"./ar-dz":6,"./ar-dz.js":6,"./ar-kw":7,"./ar-kw.js":7,"./ar-ly":8,"./ar-ly.js":8,"./ar-ma":9,"./ar-ma.js":9,"./ar-sa":10,"./ar-sa.js":10,"./ar-tn":11,"./ar-tn.js":11,"./ar.js":5,"./az":12,"./az.js":12,"./be":13,"./be.js":13,"./bg":14,"./bg.js":14,"./bm":15,"./bm.js":15,"./bn":16,"./bn-bd":17,"./bn-bd.js":17,"./bn.js":16,"./bo":18,"./bo.js":18,"./br":19,"./br.js":19,"./bs":20,"./bs.js":20,"./ca":21,"./ca.js":21,"./cs":22,"./cs.js":22,"./cv":23,"./cv.js":23,"./cy":24,"./cy.js":24,"./da":25,"./da.js":25,"./de":26,"./de-at":27,"./de-at.js":27,"./de-ch":28,"./de-ch.js":28,"./de.js":26,"./dv":29,"./dv.js":29,"./el":30,"./el.js":30,"./en-au":31,"./en-au.js":31,"./en-ca":32,"./en-ca.js":32,"./en-gb":33,"./en-gb.js":33,"./en-ie":34,"./en-ie.js":34,"./en-il":35,"./en-il.js":35,"./en-in":36,"./en-in.js":36,"./en-nz":37,"./en-nz.js":37,"./en-sg":38,"./en-sg.js":38,"./eo":39,"./eo.js":39,"./es":40,"./es-do":41,"./es-do.js":41,"./es-mx":42,"./es-mx.js":42,"./es-us":43,"./es-us.js":43,"./es.js":40,"./et":44,"./et.js":44,"./eu":45,"./eu.js":45,"./fa":46,"./fa.js":46,"./fi":47,"./fi.js":47,"./fil":48,"./fil.js":48,"./fo":49,"./fo.js":49,"./fr":50,"./fr-ca":51,"./fr-ca.js":51,"./fr-ch":52,"./fr-ch.js":52,"./fr.js":50,"./fy":53,"./fy.js":53,"./ga":54,"./ga.js":54,"./gd":55,"./gd.js":55,"./gl":56,"./gl.js":56,"./gom-deva":57,"./gom-deva.js":57,"./gom-latn":58,"./gom-latn.js":58,"./gu":59,"./gu.js":59,"./he":60,"./he.js":60,"./hi":61,"./hi.js":61,"./hr":62,"./hr.js":62,"./hu":63,"./hu.js":63,"./hy-am":64,"./hy-am.js":64,"./id":65,"./id.js":65,"./is":66,"./is.js":66,"./it":67,"./it-ch":68,"./it-ch.js":68,"./it.js":67,"./ja":69,"./ja.js":69,"./jv":70,"./jv.js":70,"./ka":71,"./ka.js":71,"./kk":72,"./kk.js":72,"./km":73,"./km.js":73,"./kn":74,"./kn.js":74,"./ko":75,"./ko.js":75,"./ku":76,"./ku.js":76,"./ky":77,"./ky.js":77,"./lb":78,"./lb.js":78,"./lo":79,"./lo.js":79,"./lt":80,"./lt.js":80,"./lv":81,"./lv.js":81,"./me":82,"./me.js":82,"./mi":83,"./mi.js":83,"./mk":84,"./mk.js":84,"./ml":85,"./ml.js":85,"./mn":86,"./mn.js":86,"./mr":87,"./mr.js":87,"./ms":88,"./ms-my":89,"./ms-my.js":89,"./ms.js":88,"./mt":90,"./mt.js":90,"./my":91,"./my.js":91,"./nb":92,"./nb.js":92,"./ne":93,"./ne.js":93,"./nl":94,"./nl-be":95,"./nl-be.js":95,"./nl.js":94,"./nn":96,"./nn.js":96,"./oc-lnc":97,"./oc-lnc.js":97,"./pa-in":98,"./pa-in.js":98,"./pl":99,"./pl.js":99,"./pt":100,"./pt-br":101,"./pt-br.js":101,"./pt.js":100,"./ro":102,"./ro.js":102,"./ru":103,"./ru.js":103,"./sd":104,"./sd.js":104,"./se":105,"./se.js":105,"./si":106,"./si.js":106,"./sk":107,"./sk.js":107,"./sl":108,"./sl.js":108,"./sq":109,"./sq.js":109,"./sr":110,"./sr-cyrl":111,"./sr-cyrl.js":111,"./sr.js":110,"./ss":112,"./ss.js":112,"./sv":113,"./sv.js":113,"./sw":114,"./sw.js":114,"./ta":115,"./ta.js":115,"./te":116,"./te.js":116,"./tet":117,"./tet.js":117,"./tg":118,"./tg.js":118,"./th":119,"./th.js":119,"./tk":120,"./tk.js":120,"./tl-ph":121,"./tl-ph.js":121,"./tlh":122,"./tlh.js":122,"./tr":123,"./tr.js":123,"./tzl":124,"./tzl.js":124,"./tzm":125,"./tzm-latn":126,"./tzm-latn.js":126,"./tzm.js":125,"./ug-cn":127,"./ug-cn.js":127,"./uk":128,"./uk.js":128,"./ur":129,"./ur.js":129,"./uz":130,"./uz-latn":131,"./uz-latn.js":131,"./uz.js":130,"./vi":132,"./vi.js":132,"./x-pseudo":133,"./x-pseudo.js":133,"./yo":134,"./yo.js":134,"./zh-cn":135,"./zh-cn.js":135,"./zh-hk":136,"./zh-hk.js":136,"./zh-mo":137,"./zh-mo.js":137,"./zh-tw":138,"./zh-tw.js":138};function a(e){var t=r(e);return n(t)}function r(e){if(!n.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}a.keys=function(){return Object.keys(i)},a.resolve=r,e.exports=a,a.id=149},150:function(e,t,n){"use strict";n.r(t);var i=n(1),a=n.n(i),r=n(139),s=n.n(r),o=n(2),c=n.n(o),d=n(0),l=n.n(d);function u(){return(u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}var m=c()("api"),h=new(function(){function e(){}var t=e.prototype;return t.__fetchJSON=function(e,t,n,i,a){void 0===i&&(i=0),void 0===a&&(a=0),fetch(e,t).then((function(e){if(m("Response code was "+e.status),e.status>=200&&e.status<=299)return e.json()})).then((function(e){m(e),n(e,200,i,a)})).catch((function(e){m(e),n(null,500,i,a)}))},t.apiFetchJSONWithPost=function(e,t,n,i,a){void 0===i&&(i=0),void 0===a&&(a=0),m("Executing fetch with URL "+e+" with body "+t);try{JSON.stringify({parameters:t})}catch(e){m("Unable to convert parameters to JSON"),m(t,100),n(null,404,i,a)}var r={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u({},t))};this.__fetchJSON(e,r,n,i,a)},t.apiFetchJSONWithGet=function(e,t,n,i,a){void 0===i&&(i=0),void 0===a&&(a=0),m("Executing GET fetch with URL "+e+" with id "+t.id);t.id&&(e+="/"+t.id),this.__fetchJSON(e,{method:"GET",headers:{"Content-Type":"application/json"}},n,i,a)},t.apiFetchJSONWithDelete=function(e,t,n,i,a){void 0===i&&(i=0),void 0===a&&(a=0),m("Executing DELETE fetch with URL "+e+" with id "+t.id);t.id&&(e+="/"+t.id),this.__fetchJSON(e,{method:"DELETE",headers:{"Content-Type":"application/json"}},n,i,a)},t.apiFetchJSONWithPut=function(e,t,n,i,a){void 0===i&&(i=0),void 0===a&&(a=0),m("Executing PUT fetch with URL "+e+" with id "+t.id);var r={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(u({},t))};t.id&&(e+="/"+t.id),this.__fetchJSON(e,r,n,i,a)},e}()),f=new(function(){function e(){}return e.prototype.getUniqueId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))},e}());function g(e,t,n,i,a,r,s){try{var o=e[r](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(i,a)}function p(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var r=e.apply(t,n);function s(e){g(r,i,a,s,o,"next",e)}function o(e){g(r,i,a,s,o,"throw",e)}s(void 0)}))}}var y=c()("api"),v=new(function(){function e(){this.backgroundQueue=[],this.priorityQueue=[],this.inProgress=[],this.callbackForQueueRequest=this.callbackForQueueRequest.bind(this)}var t=e.prototype;return t.setBackgroundChangeListener=function(e){this.backgroundChangeListener=e},t.setPriorityChangeListener=function(e){this.priorityChangeListener=e},t.getPriorityQueueCount=function(){return this.priorityQueue.length},t.getBackgroundQueueCount=function(){return this.backgroundQueue.length},t.addApiRequest=function(e,t){void 0===t&&(t=!1);var n=f.getUniqueId();e.requestId=n,y("Download Manger: Adding Queue Request "+n),y(e,200),t?(e.queueId=1,this.priorityQueue.push(e),this.priorityChangeListener&&this.priorityChangeListener.handleEventAddToQueue()):(e.queueId=0,this.backgroundQueue.push(e),this.backgroundChangeListener&&this.backgroundChangeListener.handleEventAddToQueue()),this.processQueues()},t.processPriorityQueue=function(){var e=p(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.priorityQueue.shift(),this.inProgress.push(t),this.initiateFetchForQueueItem(t);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.processBackgroundQueue=function(){var e=p(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.backgroundQueue.shift(),this.inProgress.push(t),this.initiateFetchForQueueItem(t);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.processQueues=function(){var e=p(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.priorityQueue.length+this.backgroundQueue.length;case 1:if(!(t>0)){e.next=14;break}if(y("Download Manager: processing queue, items remaining "+t),!(this.priorityQueue.length>0)){e.next=8;break}return e.next=6,this.processPriorityQueue();case 6:e.next=11;break;case 8:if(!(this.backgroundQueue.length>0)){e.next=11;break}return e.next=11,this.processBackgroundQueue();case 11:t=this.priorityQueue.length+this.backgroundQueue.length,e.next=1;break;case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.callbackForQueueRequest=function(e,t,n,i){1===n?this.priorityChangeListener&&this.priorityChangeListener.handleEventRemoveFromQueue():this.backgroundChangeListener&&this.backgroundChangeListener.handleEventRemoveFromQueue(),y("Download Manager: received callback for queue "+n+" request "+i+" with status "+t);var a=this.inProgress.findIndex((function(e){return e.requestId===i}));if(a>=0){var r=this.inProgress[a];this.inProgress.splice(a,1),y(r),y("Download Manager: finished for queue item "+r.requestId),r.callback(e,t)}},t.initiateFetchForQueueItem=function(e){if(y("Download Manager: initiating fetch for queue item "+e.requestId),y(e),null!==e.url&&null!=e.params&&null!=e.callback)switch(e.type){case"POST":h.apiFetchJSONWithPost(e.url,e.params,this.callbackForQueueRequest,e.queueId,e.requestId);break;case"GET":h.apiFetchJSONWithGet(e.url,e.params,this.callbackForQueueRequest,e.queueId,e.requestId);break;case"DELETE":h.apiFetchJSONWithDelete(e.url,e.params,this.callbackForQueueRequest,e.queueId,e.requestId);break;case"PUT":h.apiFetchJSONWithPut(e.url,e.params,this.callbackForQueueRequest,e.queueId,e.requestId)}},e}()),b=c()("state-manager"),I=new(function(){function e(){this.applicationState=[],this.stateChangeListeners=[]}var t=e.prototype;return t.__isStatePresent=function(e){var t=this.applicationState.findIndex((function(t){return t.name===e}))>=0;return b("State Manager: Checking state of "+e+" is present = "+t),t},t.__informChangeListenersForStateWithName=function(e,t){b("State Manager: Informing state listeners of "+e);var n=this.stateChangeListeners.findIndex((function(t){return t.name===e}));if(n>=0){b("State Manager: Found state listeners of "+e);for(var i=this.stateChangeListeners[n],a=0;a<i.listeners.length;a++){b("State Manager: Found state listener of "+e+" - informing"),(0,i.listeners[a])(e,t)}}},t.addChangeListenerForName=function(e,t){b("State Manager: Adding state listener for "+e);var n=this.stateChangeListeners.findIndex((function(t){return t.name===e}));if(n>=0){this.stateChangeListeners[n].listeners.push(t)}else{b("State Manager: Adding state listener for "+e+" - first occurrence");var i={name:e,listeners:[t]};this.stateChangeListeners.push(i)}},t.getStateByName=function(e){b("State Manager: Getting state for "+e);var t={},n=this.applicationState.findIndex((function(t){return t.name===e}));n>=0?(t=this.applicationState[n].value,b("State Manager: Found previous state for "+e),b(t)):t=this.addStateByName(e,[]);return t},t.setStateByName=function(e,t){b("State Manager: Setting state for "+e),b(t);var n=this.applicationState.findIndex((function(t){return t.name===e}));n>=0?this.applicationState[n].value=t:this.addStateByName(e,t);return this.__informChangeListenersForStateWithName(e,t),t},t.addStateByName=function(e,t){if(this.__isStatePresent(e))this.setStateByName(e,t);else{b("State Manager: Adding state for "+e+" - first occurrence"),b(t,201);var n={name:e,value:t};this.applicationState.push(n)}return t},t.addNewItemToState=function(e,t){b("State Manager: Adding item to state "+e);var n=this.getStateByName(e);n.push(t),b(n),this.__informChangeListenersForStateWithName(e,n)},t.findItemInState=function(e,t,n){var i={},a=this.getStateByName(e),r=a.findIndex((function(e){return n(e,t)}));return b("Finding item in state "+e+" - found index "+r),b(t),r>=0&&(i=a[r]),i},t.isItemInState=function(e,t,n){var i=!1;return this.getStateByName(e).findIndex((function(e){return n(e,t)}))>=0&&(i=!0),i},t.removeItemFromState=function(e,t,n){var i=!1,a=this.getStateByName(e),r=a.findIndex((function(e){return n(e,t)}));return r>=0&&(i=!0,b("State Manager: Found item - removing "),a.splice(r,1),b(a),this.setStateByName(e,a)),i},t.updateItemInState=function(e,t,n){var i=!1,a=this.getStateByName(e),r=a.findIndex((function(e){return n(e,t)}));return r>=0?(i=!0,b("State Manager: Found item - replacing "),a.splice(r,1,t),b(a),this.setStateByName(e,a)):this.addNewItemToState(e,t),i},e}());function E(e,t){return e.id===t.id}var w=function(){function e(e){this.show=this.show.bind(this),this.notificationManager=e,this.containerId=this.notificationManager.getContainerId()}return e.prototype.show=function(e,t,n,i,a){var r=this;void 0===n&&(n=0),void 0===i&&(i="info"),void 0===a&&(a=3e3);var s="";switch(i){case"info":s="bg-info";break;case"warning":s="bg-warning";break;case"message":s="bg-primary";break;case"priority":s="bg-danger";break;default:s="bg-info"}var o=document.createElement("div");o.className="notification toast",o.style.top=n+"px",o.setAttribute("role","alert"),o.setAttribute("data-autohide","false");var c=document.createElement("div");c.className="toast-header text-white "+s;var d=document.createElement("strong");d.className="mr-auto",d.textContent=e;var l=document.createElement("button");l.className="ml-2 mb-1 close",l.textContent="x",l.addEventListener("click",(function(){r.notificationManager.remove(o)}));var u=document.createElement("div");return u.className="toast-body",u.textContent=t,c.appendChild(d),c.appendChild(l),o.appendChild(c),o.appendChild(u),o.classList.add("is-"+i),document.getElementById(this.containerId).appendChild(o),$(".notification").toast("show"),a<=0&&(a=2e3),setTimeout((function(){r.notificationManager.remove(o)}),a),o},e}(),S=new(function(){function e(){this.notifications=[],this.currentCount=0,this.offsetPerNotification=120,this.containerId="notifications"}var t=e.prototype;return t.getContainerId=function(){return this.containerId},t.show=function(e,t,n,i){void 0===n&&(n="info"),void 0===i&&(i=5e3);var a=new w(this).show(e,t,this.currentCount*this.offsetPerNotification,n,i);this.currentCount++,this.notifications.push(a)},t.remove=function(e){var t=this,n=this.notifications.findIndex((function(t){return t===e}));n>=0&&(this.notifications.splice(n,1),this.notifications.map((function(e,n){e.style.top=t.offsetPerNotification*n+"px"})));var i=e.parentElement;null!==i&&i.removeChild(e),this.currentCount--,this.currentCount<0&&(this.currentCount=0)},e}()),C=c()("controller"),j=new(function(){function e(){}var t=e.prototype;return t.connectToApplication=function(e,t){return this.applicationView=e,this.clientSideStorage=t,this.config=this.applicationView.state,this.callbackForUsers=this.callbackForUsers.bind(this),this.callbackForEntries=this.callbackForEntries.bind(this),this.callbackForCreateEntry=this.callbackForCreateEntry.bind(this),this.callbackForCreateComment=this.callbackForCreateComment.bind(this),this.stateChangeListener=this.stateChangeListener.bind(this),I.addChangeListenerForName(this.config.stateNames.entries,this.stateChangeListener),this},t.stateChangeListener=function(e,t){C("State changes "+e),C(t),this.applicationView.setState({isLoggedIn:this.isLoggedIn(),loggedInUserId:this.getLoggedInUserId(),selectedEntry:{},entries:t})},t.callbackForUsers=function(e,t){C("callback for all users");var n=[];t>=200&&t<=299&&(C(e),n=e),I.setStateByName(this.config.stateNames.users,n)},t.callbackForEntries=function(e,t){C("callback for all entries");var n=[];t>=200&&t<=299&&(C(e),n=e),I.setStateByName(this.config.stateNames.entries,n)},t.callbackForCreateEntry=function(e,t){C("callback for create entry");var n=null;t>=200&&t<=299&&(C(e),n=e),I.addNewItemToState(this.config.stateNames.entries,n)},t.callbackForCreateComment=function(e,t){C("callback for create comment");var n=null;if(t>=200&&t<=299){C(n=e);var i=I.findItemInState(this.config.stateNames.entries,{id:n.commentOn},E);C(i),i&&(C("callback for create comment - updating entry"),i.Comments.push(n),I.updateItemInState(this.config.stateNames.entries,i,E),I.setStateByName(this.config.stateNames.selectedEntry,i),C(i))}},t.getAllUsers=function(){C("Getting All Users");var e={url:this.getServerAPIURL()+this.config.apis.users,type:"GET",params:{},callback:this.callbackForUsers};v.addApiRequest(e,!0)},t.getAllEntries=function(){C("Getting All Entries");var e={url:this.getServerAPIURL()+this.config.apis.entries,type:"GET",params:{},callback:this.callbackForEntries};v.addApiRequest(e,!0)},t.apiDeleteComment=function(e){if(e){var t={url:this.getServerAPIURL()+this.config.apis.comment,type:"DELETE",params:{id:e},callback:function(e,t){C("callback for delete comment"),t>=200&&t<=299&&C(e)}};v.addApiRequest(t)}},t.apiDeleteEntry=function(e){if(e){var t={url:this.getServerAPIURL()+this.config.apis.entries,type:"DELETE",params:{id:e.id},callback:function(e,t){C("callback for delete entry"),t>=200&&t<=299&&C(e)}};v.addApiRequest(t)}},t.apiCreateEntry=function(e){if(e){var t={url:this.getServerAPIURL()+this.config.apis.entries,type:"POST",params:e,callback:this.callbackForCreateEntry};v.addApiRequest(t,!0)}},t.apiCreateComment=function(e){if(e){var t={url:this.getServerAPIURL()+this.config.apis.comment,type:"POST",params:e,callback:this.callbackForCreateComment};v.addApiRequest(t,!0)}},t.apiUpdateEntry=function(e){if(e){var t={url:this.getServerAPIURL()+this.config.apis.entries,type:"PUT",params:e,callback:function(e,t){C("callback for update entry"),t>=200&&t<=299&&C(e)}};v.addApiRequest(t)}},t.getServerAPIURL=function(){var e="/api";return window.ENV&&window.ENV.serverURL&&(e=window.ENV.serverURL),e},t.isLoggedIn=function(){var e=!1;try{loggedInUserId&&(e=!0)}catch(e){}return C("Are logged in: "+e),e},t.getLoggedInUserId=function(){var e=-1;try{loggedInUserId&&(e=loggedInUserId)}catch(e){}return C("Logged in user id: "+e),e},t.initialise=function(){C("Initialising data state"),this.getAllUsers(),this.getAllEntries()},t.deleteComment=function(e){var t=I.getStateByName(this.config.stateNames.selectedEntry);if(t){C("Handling delete comment for "+t.id+" and comment "+e);var n=t.Comments,i=n.findIndex((function(t){return t.id===e}));i>=0&&(C("Found comment in entry - removing"),n.splice(i,1),C(t),I.setStateByName(this.config.stateNames.selectedEntry,t),I.updateItemInState(this.config.stateNames.entries,t,E))}this.apiDeleteComment(e)},t.deleteEntry=function(e){e&&(C("Handling delete entry for "+e.id),I.removeItemFromState(this.config.stateNames.entries,e,E),this.apiDeleteEntry(e))},t.updateEntry=function(e){e&&(C(e),e.id?(C("Handling update for entry "+e.id),I.updateItemInState(this.config.stateNames.entries,e,E),this.apiUpdateEntry(e)):(C("Handling create for entry"),this.apiCreateEntry(e)))},t.addComment=function(e){e&&(C(e),C("Handling create for comment"),this.apiCreateComment(e))},t.handleDataChangedByAnotherUser=function(e){C("Handling data change "+e.type+" on object type "+e.objectType+" made by user "+e.user);var t=I.findItemInState(this.config.stateNames.users,{id:e.user},E),n=e.data;C(n);try{switch(e.type){case"create":switch(e.objectType){case"Comment":var i=I.findItemInState(this.config.stateNames.entries,{id:n.commentOn},E);if(i){i.Comments.push(n),I.updateItemInState(this.config.stateNames.entries,i,E);var a=I.getStateByName(this.config.stateNames.selectedEntry);a&&a.id===i.id&&I.setStateByName(this.config.stateNames.selectedEntry,i);var r="unknown";t&&(r=t.username),S.show(i.title,r+" added comment "+n.content)}break;case"BlogEntry":I.addNewItemToState(this.config.stateNames.entries,n);var s="unknown";t&&(s=t.username),S.show(n.title,s+" added new entry");break;case"User":I.addNewItemToState(this.config.stateNames.users,n),S.show(n.username,n.username+" has just registered.","message")}break;case"update":switch(e.objectType){case"BlogEntry":I.updateItemInState(this.config.stateNames.entries,n,E)}break;case"delete":switch(e.objectType){case"Comment":var o=I.findItemInState(this.config.stateNames.entries,{id:n.commentOn},E);if(C(o),o){var c=o.Comments,d=c.findIndex((function(e){return e.id===n.id}));if(d>=0){C("Found comment in entry - removing"),c.splice(d,1),C(o),I.updateItemInState(this.config.stateNames.entries,o,E);var l=I.getStateByName(this.config.stateNames.selectedEntry);l&&l.id===o.id&&I.setStateByName(this.config.stateNames.selectedEntry,o)}}break;case"BlogEntry":C("Deleting Blog Entry with id "+n.id);var u=I.findItemInState(this.config.stateNames.entries,n,E);if(C(u),u){C("Deleting Blog Entry with id "+u.id),I.removeItemFromState(this.config.stateNames.entries,u,E);var m=I.getStateByName(this.config.stateNames.selectedEntry);m&&m.id===u.id&&(C("Deleted entry is selected by user, closing sidebars"),this.applicationView.hideAllSideBars())}}}}catch(e){C(e)}},e}()),k=new(function(){function e(){}var t=e.prototype;return t.scrollSmoothToId=function(e){document.getElementById(e).scrollIntoView({block:"start",behavior:"smooth"})},t.scrollSmoothTo=function(e){e.scrollIntoView({block:"start",behavior:"smooth"})},t.removeAllChildren=function(e){if(e&&e.firstChild)for(;e.firstChild;)e.removeChild(e.lastChild)},t.addRemoveClasses=function(e,t,n){void 0===n&&(n=!0),t.split(" ").forEach((function(t){t.trim().length>0&&(n?e.classList.add(t):e.classList.remove(t))}))},e}()),N=new c.a("view");function D(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function x(e,t){return(x=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var L=function(e){var t,n;function i(t,n,i,a){var r;return(r=e.call(this,t,n,i,a)||this).eventHide=r.eventHide.bind(D(r)),r.eventShow=r.eventShow.bind(D(r)),r}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,x(t,n);var a=i.prototype;return a.onDocumentLoaded=function(){this.eventHide(null);var e=this.document.getElementById(this.uiConfig.dom.sideBarId).querySelector(".close");e&&e.addEventListener("click",this.eventHide)},a.__showHide=function(e){var t=this.document.getElementById(this.uiConfig.dom.sideBarId);switch(this.uiPrefs.view.location){case"left":case"right":t.style.width=e;break;case"bottom":case"top":t.style.height=e}},a.eventHide=function(e){e&&e.preventDefault(),this.__showHide("0%")},a.eventShow=function(e){this.__showHide(this.uiPrefs.view.expandedSize)},i}(function(){function e(e,t,n,i){this.applicationView=e,this.document=document,this.uiConfig=n,this.uiPrefs=i,this.stateChangedHandler=this.stateChangedHandler.bind(this),this.eventStartDrag=this.eventStartDrag.bind(this),this.eventClickItem=this.eventClickItem.bind(this)}var t=e.prototype;return t.onDocumentLoaded=function(){throw new Error("implement in sub-class")},t.stateChangedHandler=function(e,t){this.updateView(e,t)},t.updateView=function(e,t){throw new Error("Must be implemented in subclass")},t.eventStartDrag=function(e){N("Abstract View : drag start",10);var t=JSON.stringify(this.getDragData(e));N(t,10),e.dataTransfer.setData(this.applicationView.state.ui.draggable.draggableDataKeyId,t)},t.eventClickItem=function(e){throw new Error("Must be implemented in subclass")},t.getDragData=function(e){throw new Error("Must be implemented in subclass")},t.getIdForStateItem=function(e,t){throw new Error("Must be implemented in subclass")},t.getLegacyIdForStateItem=function(e,t){throw new Error("Must be implemented in subclass")},t.getDisplayValueForStateItem=function(e,t){throw new Error("Must be implemented in subclass")},t.getModifierForStateItem=function(e,t){throw new Error("Must be implemented in subclass")},t.getSecondaryModifierForStateItem=function(e,t){throw new Error("Must be implemented in subclass")},t.createResultsForState=function(e,t){var n=this;N("Abstract View : creating Results",10),N(t);var i=this.uiConfig.dom,a=document.getElementById(i.resultsId);k.removeAllChildren(a),t.map((function(t,r){var s=n.document.createElement(i.resultsElementType);k.addRemoveClasses(s,i.resultsClasses),s.setAttribute(i.resultDataKeyId,n.getIdForStateItem(e,t)),s.setAttribute(i.resultLegacyDataKeyId,n.getLegacyIdForStateItem(e,t)),s.setAttribute(i.resultDataSourceId,i.resultDataSourceValue);var o=n.getDisplayValueForStateItem(e,t),c=n.getModifierForStateItem(e,t),d=n.getSecondaryModifierForStateItem(e,t);switch(c){case"normal":switch(N("Abstract View: normal item",10),k.addRemoveClasses(s,i.modifierClassNormal),""!==i.iconNormal?s.innerHTML=o+i.iconNormal:s.innerText=o,d){case"warning":k.addRemoveClasses(s,i.modifierClassNormal,!1),k.addRemoveClasses(s,i.modifierClassWarning,!0),""!==i.iconWarning&&(s.innerHTML+=i.iconWarning)}break;case"active":switch(N("Abstract View: active item",10),k.addRemoveClasses(s,i.modifierClassActive),""!==i.iconActive?s.innerHTML=o+i.iconActive:s.innerText=o,d){case"warning":k.addRemoveClasses(s,i.modifierClassNormal,!1),k.addRemoveClasses(s,i.modifierClassWarning,!0),""!==i.iconWarning&&(s.innerHTML+=i.iconWarning)}break;case"inactive":switch(N("Abstract View: inactive item",10),k.addRemoveClasses(s,i.modifierClassInactive),""!==i.iconInactive?s.innerHTML=o+i.iconInactive:s.innerText=o,d){case"warning":""!==i.iconWarning&&(s.innerHTML+=i.iconWarning)}}i.isDraggable&&(s.setAttribute("draggable","true"),s.addEventListener("dragstart",n.eventStartDrag)),i.isClickable&&s.addEventListener("click",n.eventClickItem),N("Abstract View: Adding child "+t.id),a.appendChild(s)}))},e}());function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var F=c()("view:comments"),B=function(e){var t,n;function i(t,n){var i;return(i=e.call(this,t,n,t.state.ui.commentSideBar,t.state.uiPrefs.commentSideBar)||this).config=t.state,i.updateView=i.updateView.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(i)),i.commentHeaderEl=n.getElementById(i.uiConfig.dom.headerId),i.newCommentFormEl=n.getElementById(i.uiConfig.dom.newFormId),i.newCommentFormEl.addEventListener("submit",i.applicationView.handleAddComment),i.newCommentTextEl=n.getElementById(i.uiConfig.dom.commentId),i.newCommentSubmitEl=n.getElementById(i.uiConfig.dom.submitCommentId),I.addChangeListenerForName(i.config.stateNames.selectedEntry,i.stateChangedHandler),i}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,A(t,n);var a=i.prototype;return a.getIdForStateItem=function(e,t){return t.id},a.getLegacyIdForStateItem=function(e,t){return t.id},a.getDisplayValueForStateItem=function(e,t){F("Getting display value for comment "+t.id+" with content "+t.content);var n=I.findItemInState(this.config.stateNames.users,{id:t.createdBy},E),i=l()(t.changedOn,"YYYYMMDDHHmmss").format("DD/MM/YYYY HH:mm");return t.content+" - "+n.username+" on "+i+"  "},a.getModifierForStateItem=function(e,t){var n="inactive";return t.createdBy===j.getLoggedInUserId()&&(n="normal"),n},a.getSecondaryModifierForStateItem=function(e,t){return"normal"},a.eventClickItem=function(e){e.preventDefault();var t=I.getStateByName(this.config.stateNames.selectedEntry);F(e.target);var n=e.target.getAttribute(this.uiConfig.dom.resultDataKeyId);if(!n){var i=e.target.parentNode;n=i.getAttribute(this.uiConfig.dom.resultDataKeyId)}if(F("Comment "+e.target.innerText+" with id "+n+" clicked",20),n){n=parseInt(n);var a=t.Comments.find((function(e){return e.id===n}));a&&(F("Comment created by "+a.createdBy+" and current user is "+j.getLoggedInUserId()),a.createdBy===j.getLoggedInUserId()&&this.applicationView.handleDeleteComment(parseInt(n)))}},a.updateView=function(e,t){F("Updating view"),F(t),j.isLoggedIn()?(this.newCommentTextEl.removeAttribute("readonly"),this.newCommentSubmitEl.removeAttribute("disabled")):(this.newCommentTextEl.setAttribute("readonly",!0),this.newCommentSubmitEl.setAttribute("disabled",!0)),t&&t.Comments&&(this.commentHeaderEl.innerHTML=t.title,F(t.Comments),this.createResultsForState(e,t.Comments))},a.getDragData=function(e){},i}(L);function M(e,t){return(M=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var O=c()("view:blogentry"),U=function(e){var t,n;function i(){return e.call(this)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,M(t,n),i.prototype.render=function(){var e,t,n=this.props,i=(n.uiConfig,n.uiPrefs,n.entry),r=n.showCommentsHandler,s=n.editEntryHandler,o=n.deleteEntryHandler;return i?(O("Entry "+i.User.id+" === "+j.getLoggedInUserId()),i.User.id===j.getLoggedInUserId()?(e=a.a.createElement("button",{type:"button",className:"btn-primary btn-sm rounded p-1 mr-2","entry-id":i.id,onClick:s},"  Edit  ",a.a.createElement("i",{className:"fas fa-edit"}),"  "),t=a.a.createElement("button",{type:"button",className:"btn-warning btn-sm rounded p-1 mr-2","entry-id":i.id,onClick:o},"  Delete  ",a.a.createElement("i",{className:"fas fa-trash-alt"}),"  ")):(e=a.a.createElement("button",{type:"button",className:"btn-outline-secondary btn-sm rounded p-1 mr-2 ",disabled:!0},"  Edit  ",a.a.createElement("i",{className:"fas fa-edit"}),"  "),t=a.a.createElement("button",{type:"button",className:"btn-outline-secondary btn-sm rounded p-1 mr-2",disabled:!0},"  Delete  ",a.a.createElement("i",{className:"fas fa-trash-alt"}),"  ")),a.a.createElement("div",{className:"col-sm-12 col-md-6 col-lg-4 col-xl-3 p-2"},a.a.createElement("div",{className:"card",style:{width:"350px"}},a.a.createElement("div",{className:"card-header"},i.title,"    ",a.a.createElement("a",{className:"text-decoration-none"},a.a.createElement("i",{className:"fas fa-comments text-secondary","entry-id":i.id,onClick:r}),"  ",a.a.createElement("span",{className:"badge badge-pill badge-primary text-right","entry-id":i.id,onClick:r}," ",i.Comments.length," "))),a.a.createElement("div",{className:"card-body"},a.a.createElement("p",{className:"card-text"},i.content),e,t),a.a.createElement("div",{className:"card-footer text-right text-muted"},i.User.username," on ",l()(i.changedOn,"YYYYMMDDHHmmss").format("DD/MM/YYYY"))))):a.a.createElement("div",null)},i}(a.a.Component);function T(e,t){return(T=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var H=new c.a("view:details"),R=function(e){var t,n;function i(t,n){var i;return(i=e.call(this,t,n,t.state.ui.entryDetailsSideBar,t.state.uiPrefs.entryDetailsSideBar)||this).config=t.state,i.updateView=i.updateView.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(i)),i.formEl=document.getElementById(i.uiConfig.dom.formId),i.titleEl=document.getElementById(i.uiConfig.dom.titleId),i.contentEl=document.getElementById(i.uiConfig.dom.contentId),i.changeOnEl=document.getElementById(i.uiConfig.dom.changedOnId),I.addChangeListenerForName(i.config.stateNames.selectedEntry,i.stateChangedHandler),i.formEl.addEventListener("submit",i.eventClickItem),i}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,T(t,n);var a=i.prototype;return a.getIdForStateItem=function(e,t){return t.id},a.getLegacyIdForStateItem=function(e,t){return t.id},a.eventClickItem=function(e){e.preventDefault(),H("Handling submit Details Sidebar View"),H(e.target);var t=I.getStateByName(this.config.stateNames.selectedEntry);H(t),t.title=this.titleEl.value.trim(),t.content=this.contentEl.value.trim(),t.changedOn=parseInt(l()().format("YYYYMMDDHHmmss")),H(t),this.titleEl.value="",this.contentEl.value="",this.changeOnEl.innerText="Last Changed On:",this.applicationView.handleUpdateEntry(t)},a.updateView=function(e,t){H("Handling update of Details Sidebar View"),H(t),t&&t.title?(this.titleEl.value=t.title,this.contentEl.value=t.content,this.changeOnEl.innerText="Last Changed On: "+l()(t.changedOn,"YYYYMMDDHHmmss").format("DD/MM/YYYY")):(this.titleEl.value="",this.contentEl.innerText="",this.changeOnEl.innerText="Last Changed On: ")},i}(L),P=c()("socket"),_=new(function(){function e(){this.callbackForMessage=this.callbackForMessage.bind(this),this.callbackForData=this.callbackForData.bind(this)}var t=e.prototype;return t.callbackForMessage=function(e){P("Received message : "+e)},t.callbackForData=function(e){P("Received data");try{var t=JSON.parse(e);P(t),t.user===this.applicationView.getCurrentUser()?P("change made by this user, ignoring"):(P("change made by another user, passing off to the application"),this.applicationView.handleDataChangedByAnotherUser(t))}catch(e){P("Not JSON data")}},t.connectToApplication=function(e){P("Connecting to application"),this.applicationView=e,P("Creating socket connection"),this.socket=io(),P("Waiting for messages"),this.socket.on("message",this.callbackForMessage),this.socket.on("data",this.callbackForData)},t.sendMessage=function(e){this.socket.emit("message",e)},e}());function V(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function q(e,t){return(q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Q=c()("app"),Y=function(e){var t,n;function i(){var t;return(t=e.call(this)||this).state={isLoggedIn:!1,loggedInUserId:-1,entries:[],selectedEntry:{},applyUserFilter:!1,stateNames:{users:"users",entries:"entries",selectedEntry:"selectedEntry"},apis:{users:"/users",entries:"/blog",entry:"/blog",comment:"/comment",login:"/login"},ui:{navigation:{showMyEntriesId:"navigationItemDashboard",addNewEntryId:"navigationItemAddNewEntry",showAllEntriesId:"navigationItemShowAll"},blogEntry:{},entryDetailsSideBar:{dom:{sideBarId:"detailsSideBar",formId:"details",titleId:"title",contentId:"content",changedOnId:"changedOn",resultDataKeyId:"id",isDraggable:!1,isClickable:!0}},commentSideBar:{dom:{sideBarId:"commentSideBar",headerId:"commentHeader",resultsId:"comments",resultsElementType:"button",resultsElementAttributes:[["type","button"]],resultsClasses:"list-group-item my-list-item truncate-comment list-group-item-action",resultDataKeyId:"id",resultLegacyDataKeyId:"id",modifierClassNormal:"float-right list-group-item-primary text-right",modifierClassInactive:"float-left list-group-item-dark text-left",modifierClassActive:"list-group-item-primary",modifierClassWarning:"list-group-item-warning",iconNormal:'<i class="fas fa-trash-alt"></i>',iconInactive:"",iconActive:"",iconWarning:"",isDraggable:!1,isClickable:!0,newFormId:"newComment",commentId:"comment",submitCommentId:"submitComment"}}},uiPrefs:{navigation:{},blogEntry:{},commentSideBar:{view:{location:"right",expandedSize:"50%"}},entryDetailsSideBar:{view:{location:"left",expandedSize:"35%"}}},controller:{events:{entry:{eventDataKeyId:"entry-id"}},dataLimit:{}}},t.handleAllEntries=t.handleAllEntries.bind(V(t)),t.handleShowMyEntries=t.handleShowMyEntries.bind(V(t)),t.handleSelectEntryComments=t.handleSelectEntryComments.bind(V(t)),t.handleShowEditEntry=t.handleShowEditEntry.bind(V(t)),t.handleUpdateEntry=t.handleUpdateEntry.bind(V(t)),t.handleAddEntry=t.handleAddEntry.bind(V(t)),t.handleAddComment=t.handleAddComment.bind(V(t)),t.handleDeleteEntry=t.handleDeleteEntry.bind(V(t)),t.handleDeleteComment=t.handleDeleteComment.bind(V(t)),t.controller=j.connectToApplication(V(t),window.localStorage),_.connectToApplication(V(t)),t}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,q(t,n);var r=i.prototype;return r.getCurrentUser=function(){return j.getLoggedInUserId()},r.handleDataChangedByAnotherUser=function(e){Q("Received new data, passing to Controller"),j.handleDataChangedByAnotherUser(e)},r.render=function(){var e=this;Q("Rendering App"),Q(this.state.entries),Q(this.state.applyUserFilter);var t=this.state.entries;this.state.applyUserFilter&&j.isLoggedIn()&&j.getLoggedInUserId()>0&&(t=t.filter((function(e){return e.createdBy===j.getLoggedInUserId()})));var n=t.map((function(t,n){return a.a.createElement(U,{key:n,uiConfig:e.state.ui.blogEntry,uiPrefs:e.state.uiPrefs.blogEntry,entry:t,showCommentsHandler:e.handleSelectEntryComments,editEntryHandler:e.handleShowEditEntry,deleteEntryHandler:e.handleDeleteEntry})}));return a.a.createElement("div",{className:"Root row ml-1"},n)},r.componentDidMount=function(){Q("component Did Mount"),this.commentView=new B(this,document),this.commentView.onDocumentLoaded(),this.detailsView=new R(this,document),this.detailsView.onDocumentLoaded(),document.getElementById(this.state.ui.navigation.addNewEntryId).addEventListener("click",this.handleAddEntry),document.getElementById(this.state.ui.navigation.showMyEntriesId).addEventListener("click",this.handleShowMyEntries),this.controller.initialise()},r.hideAllSideBars=function(){this.commentView.eventHide(null),this.detailsView.eventHide(null)},r.handleShowMyEntries=function(e){Q("Handling Show My Entries"),this.hideAllSideBars(),j.isLoggedIn()?this.setState({applyUserFilter:!0}):window.location.href=this.state.apis.login},r.handleAllEntries=function(e){Q("Handling Show All Entries"),this.setState({applyUserFilter:!1}),this.hideAllSideBars()},r.handleAddEntry=function(e){if(Q("Handling Add Entry"),e.preventDefault(),this.hideAllSideBars(),j.isLoggedIn()){var t=I.findItemInState(this.state.stateNames.users,{id:j.getLoggedInUserId()},E);Q(t);var n={title:"",content:"",createdBy:t.id,changedOn:parseInt(l()().format("YYYYMMDDHHmmss")),Comments:[],User:{id:t.id,username:t.username}};Q(n),this.setState({selectedEntry:n}),I.setStateByName(this.state.stateNames.selectedEntry,n),this.detailsView.eventShow(e)}else window.location.href=this.state.apis.login},r.handleAddComment=function(e){Q("Handling Add Comment"),e.preventDefault();var t=document.getElementById(this.state.ui.commentSideBar.dom.commentId);if(0!==t.value.trim().length)if(j.isLoggedIn()){var n=I.findItemInState(this.state.stateNames.users,{id:j.getLoggedInUserId()},E);Q(n);var i=I.getStateByName(this.state.stateNames.selectedEntry);if(i&&t){var a={createdBy:n.id,commentOn:i.id,changedOn:parseInt(l()().format("YYYYMMDDHHmmss")),content:t.value.trim()};t.value="",j.addComment(a),Q(a)}}else window.location.href=this.state.apis.login},r.handleSelectEntryComments=function(e){Q("Handling Select Entry Comments"),e.preventDefault(),this.hideAllSideBars();var t=e.target.getAttribute(this.state.controller.events.entry.eventDataKeyId);if(Q("Handling Show Edit Entry "+t),t){t=parseInt(t);var n=I.findItemInState(this.state.stateNames.entries,{id:t},E);Q(n),n&&(this.setState({selectedEntry:n}),I.setStateByName(this.state.stateNames.selectedEntry,n),this.commentView.eventShow(e))}},r.handleShowEditEntry=function(e){e.preventDefault(),this.hideAllSideBars();var t=e.target.getAttribute(this.state.controller.events.entry.eventDataKeyId);if(Q("Handling Show Edit Entry "+t),t){t=parseInt(t);var n=I.findItemInState(this.state.stateNames.entries,{id:t},E);Q(n),n&&(this.setState({selectedEntry:n}),I.setStateByName(this.state.stateNames.selectedEntry,n),this.detailsView.eventShow(e))}},r.handleDeleteEntry=function(e){e.preventDefault(),this.hideAllSideBars();var t=e.target.getAttribute(this.state.controller.events.entry.eventDataKeyId);if(Q("Handling Delete Entry "+t),t){t=parseInt(t);var n=I.findItemInState(this.state.stateNames.entries,{id:t},E);n&&(j.deleteEntry(n),I.removeItemFromState(this.state.stateNames.entries,n,E))}},r.handleDeleteComment=function(e){j.deleteComment(e)},r.handleUpdateEntry=function(e){this.hideAllSideBars(),j.updateEntry(e)},r.componentDidUpdate=function(e,t,n){Q("component Did Update")},i}(a.a.Component);localStorage.debug="app view controller socket",c.a.log=console.info.bind(console);var z=a.a.createElement(Y,{className:"container-fluid justify-content-around"});s.a.render(z,document.getElementById("root"))}});